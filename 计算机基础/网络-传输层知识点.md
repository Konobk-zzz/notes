# 传输层概述

* 作用：传输层为它上面的应用层提供通信服务。

* 在OSI七层参考模型中，传输层是面向通信的最高层，也是用户功能的最底层。

* 传输层两大重要的功能：复用 和 分用。
  * 复用：在发送端，多个应用进程公用一个传输层；
  * 分用：在接收端，传输层会根据端口号将数据分派给不同的应用进程。
* 和网络层的区别：
  * 网络层为不同主机提供通信服务，而传输层为不同主机的不同应用提供通信服务。
  * 网络层只对报文头部进行差错检测，而传输层对整个报文进行差错检测。

# OSI参考模型

​		为了更好地促进互联网络的研究和发展，国际标准化组织ISO制定了网络互连的七层框架的一个参考模型，称为开放系统互连参考模型，简称OSI/RM(Open System Internetwork Reference Model)。

## 层次划分原则

​		OSI是分层的体系结构，每一层是一个模块，用于完成某种功能，并具有自己的通信协议。ISO将整个OSI划分成七个层次，划分层次依据以下五个原则：

​	(1)网络中各节点具有相同的层次；

​	(2)网络中各节点同等层次功能相同；

​	(3)同一节点内相邻层通过接口通信；

​	(4)同一节点内底层向高层提供服务；

​	(5)网络中各节点同层通过协议通信。

​		OSI划分的七个层次由高到低依次为：Application(应用层)、Presentation(表示层)、Session(会话层)、Transport(传输层)、Network(网络层)、DataLink(数据链路层)和Physical(物理层)。其中应用层、表示层和会话层可以视为应用层，而剩余层则可视为数据流动层。

## 层次结构及功能

### 物理层

​		物理层是参考模型中的最底层，主要定义了系统的电气、机械、过程和功能标准。如：电压、物理数据速率、最大传输距离、物理联接器和其他的类似特性。物理层的主要功能是利用传输介质为数据链路层提供物理联接，负责数据流的物理传输工作。物理层传输的基本单位是比特流，即0和1，也就是最基本的电信号或光信号，是最基本的物理传输特征。

### 数据链路层

​		数据链路层是在通信实体间建立数据链路联接，传输的基本单位为“帧”，并为网络层提供差错控制和流量控制服务。数据链路层由MAC(介质访问控制子层)和LLC(逻辑链路控制子层)组成。介质访问控制子层的主要任务是规定如何在物理线路上传输帧。逻辑链路控制子层对在同一条网络链路上的设备之间的通信进行管理。数据链路控制子层主要负责逻辑上识别不同协议类型，并对其进行封装。也就是说数据链路控制子层会接受网络协议数据、分组的数据报并且添加更多的控制信息，从而把这个分组传送到它的目标设备。

### 网络层

​		网络层主要为数据在节点之间传输创建逻辑链路，通过路由选择算法为分组选择最佳路径，从而实现拥塞控制、网络互联等功能。网络层是以路由器为最高节点俯瞰网络的关键层，它负责把分组从源网络传输到目标网络的路由选择工作。互联网是由多个网络组成在一起的一个集合，正是借助了网络层的路由路径选择功能，才能使得多个网络之间的联接得以畅通，信息得以共享。网络层提供的服务有面向联接和面向无联接的服务两种。面向联接的服务是可靠的联接服务，是数据在交换之前必须先建立联接，然后传输数据，结束后终止之前建立联接的服务。网络层以虚电路服务的方式实现面向联接的服务。面向无联接的服务是一种不可靠的服务，不能防止报文的丢失、重发或失序。面向无联接的服务优点在于其服务方式灵活方便，并且非常迅速。网络层以数据报服务的方式实现面向无联接的服务。

### 传输层

​		传输层是网络体系结构中高低层之间衔接的一个接口层。传输层不仅仅是一个单独的结构层，而是整个分析体系协议的核心。传输层主要为用户提供End—to—End(端到端)服务，处理数据报错误、数据包次序等传输问题。传输层是计算机通信体系结构中关键一层，它向高层屏蔽了下层数据的通信细节，使用户完全不用考虑物理层、数据链路层和网络层工作的详细情况。传输层使用网络层提供的网络联接服务，依据系统需求可以选择数据传输时使用面向联接的服务或是面向无联接的服务。

### 会话层

​		会话层的主要功能是负责维护两个节点之间的传输联接，确保点到点传输不中断，以及管理数据交换等功能。会话层在应用进程中建立、管理和终止会话。会话层还可以通过对话控制来决定使用何种通信方式，全双工通信或半双工通信。会话层通过自身协议对请求与应答进行协调。

### 表示层

​		表示层为在应用过程之间传送的信息提供表示方法的服务。表示层以下各层主要完成的是从源端到目的端可靠地的数据传送，而表示层更关心的是所传送数据的语法和语义。表示层的主要功能是处理在两个通信系统中交换信息的表示方式，主要包括数据格式变化、数据加密与解密、数据压缩与解压等。在网络带宽一定的前提下数据压缩的越小其传输速率就越快，所以表示层的数据压缩与解压被视为掌握网络传输速率的关键因素。表示层提供的数据加密服务是重要的网络安全要素，其确保了数据的安全传输，也是各种安全服务最为重视的关键。表示层为应用层所提供的服务包括：语法转换、语法选择和联接管理。

### 应用层

​		应用层是OSI模型中的最高层，是直接面向用户的一层，用户的通信内容要由应用进程解决，这就要求应用层采用不同的应用协议来解决不同类型的应用要求，并且保证这些不同类型的应用所采用的低层通信协议是一致的。应用层中包含了若干独立的用户通用服务协议模块，为网络用户之间的通信提供专用的程序服务。需要注意的是应用层并不是应用程序，而是为应用程序提供服务。

## 数据封装过程

​		在OSI参考模型中，当一台主机需要传送用户的数据(DATA)时，数据首先通过应用层的接口进入应用层。在应用层，用户的数据被加上应用层的报头(AH)，形成应用层协议数据单元，然后通过应用层与表示层的接口数据单元，递交到表示层。
​		表示层并不“关心”应用层的数据格式，而是把整个应用层递交的数据报看成是一个整体进行封装，即加上表示层的报头(PH)，然后递交到会话层。
​		同样，会话层、传输层、网络层、数据链路层也都要分别给上层递交下来的数据加上自己的报头。它们是会话层报头(SH)、传输层报头(TH)、网络层报头(NH)和数据链路层报头(DH)。其中，数据链路层还要给网络层递交的数据加上数据链路层报尾(DT)形成最终的一帧数据。
​		当一帧数据通过物理层传送到目标主机的物理层时，该主机的物理层把它递交到数据链路层。数据链路层负责去掉数据帧的帧头部DH和尾部DT(同时还进行数据校验)。如果数据没有出错，则递交到网络层。
​		同样，网络层、传输层、会话层、表示层、应用层也要做类似的工作。最终，原始数据被递交到目标主机的具体应用程序中。

![数据封装过程](https://bkimg.cdn.bcebos.com/pic/2f738bd4b31c8701a1dd8397287f9e2f0708ff53?x-bce-process=image/resize,m_lfit,w_640,limit_1/format,f_auto)

# UDP（用户数据报协议）详解

## UDP的特点

1. UDP只在IP数据报服务的基础上增加了少量的功能：复用与分用、对整个报文的差错检测。

2. UDP是无连接的
   通信前不需要建立连接，通信结束也无需释放连接。

3. UDP是不可靠的
   它是尽力而为交付，不能确保每一个数据报都送达。

4. UDP是面向报文的
   所谓『面向报文』就是指：UDP数据传输的单位是报文，且不会对数据作任何 拆分 和 拼接 操作。
   在发送端，应用程序给传输层的UDP什么样的数据，UDP不会对数据进行切分，只增加一个UDP头并交给网络层。
   在接收端，UDP收到网络层的数据报后，去除IP数据报头部后遍交给应用层，不会作任何拼接操作。

5. UDP没有拥塞控制
   UDP始终以恒定的速率发送数据，并不会根据网络拥塞情况对发送速率作调整。这种方式有利有弊。
   弊端：网络拥塞时有些报文可能会丢失，因此UDP不可靠。
   优点：有些使用场景允许报文丢失，如：直播、语音通话，但对实时性要求很高，此时UDP还是很有用武之地的。

6. UDP支持一对一、一对多、多对多、多对一通信
   而TCP只支持一对一通信。

7. UDP首部开销小，只有8字节。
   而TCP头部至少由20字节，相比于TCP要高效很多。